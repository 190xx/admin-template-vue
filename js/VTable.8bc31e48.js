(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["VTable"],{"2d11":function(t,e,a){},f4f7:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"own-table"},[a("ATable",t._g(t._b({attrs:{columns:t.slotColumns,"data-source":t.tableData,loading:t.loading,pagination:t.pagination&&Object.assign({},t.pagination,{total:t.total},t.tableParams),"row-key":t.rowKey,"row-selection":t.rowSelection,scroll:t.scroll},on:{change:t.setTableParams},scopedSlots:t._u([t._l(t.nativeRenderKeys,(function(e){return{key:e,fn:function(a){return[t._t(e,null,null,a)]}}})),t._l(t.customRenderKeys,(function(e){return{key:e,fn:function(s,i,l){return[t._t(e,[a("span",{key:e+"-"+l},[t._v(t._s(s))])],null,{row:i,index:l,value:s})]}}}))],null,!0)},"ATable",t.$attrs,!1),t.$listeners)),t.isXlsx&&"function"===typeof t.xlsx&&!t.loading?[a("TableToXlsx",{attrs:{"is-selection":!!t.rowSelection,loading:t.loading},on:{export:t.exportCurrent,"export-all":function(e){return t.exportAllXlsx()},"export-selected":t.exportSelected}})]:t._e()],2)},i=[],l=(a("2532"),a("ddb0"),a("15fd")),r=a("5530"),n=(a("5319"),a("fd4e"));const o=n["c"],c=/\[(?:(\d+)|['"]([^.[]+)['"])]|\.(\w+)|^(\w+)/g,h=Object(n["a"])(t=>{const e=[];return t.replace(c,(...t)=>{const a=t.slice(1,-2).find(Boolean);e.push(a)}),e});function d(t,e){if(Object(n["h"])(t)){const a=h(t);return a.reduce((t,e)=>t[e],e)}return Object(n["g"])(t)?t(e):e}function u(t,{current:e=1,pageSize:a}){const s=(e-1)*a;return t.slice(s,s+a)}var p={props:{rowKey:{type:[Function,String],required:!0},series:{type:[Boolean,Object],default:!0},lazy:Boolean,isPaging:Boolean,columns:{type:Array,required:!0,validator:t=>t.every(t=>void 0!==(t.key||t.dataIndex))},http:Function,dataSource:Array,isXlsx:Boolean,xlsx:Function,fileName:{type:String,default:"file"},params:Object,pagination:{type:[Object,Boolean],default:()=>({position:"bottom",showSizeChanger:!0,showQuickJumper:!0,showTotal:t=>`共 ${t} 条`})},current:{type:Number,default:1},pageSize:{type:Number,default:10},selection:{type:[Object,Boolean],default:!1},selectedKeys:Array,scroll:Object,handler:{type:Function,default:t=>t},isReload:Boolean},watch:{params:{handler(t){if(o(t,this.cacheTableParams))return;this.cacheTableParams=Object(r["a"])({},t),this.updateForce();const{pageSize:e,filter:a,sorter:s}=this.tableParams;this.setTableParams({current:1,pageSize:e},a,s)},deep:!0},current:{handler(t){this.tableParams.current=Math.max(t,1)},immediate:!0},pageSize:{handler(t){this.tableParams.pageSize=Math.max(t,1)},immediate:!0},isReload(t){t&&this.setTableList()},dataSource(){this.updateForce(),this.setTableList()}}};const b="__SLOT_SERIAL_NUMBER__",m=["title","expandedRowRender","expandIcon","footer"],f=m.concat(b);var g={name:"VTable",components:{TableToXlsx:()=>a.e("TableToXlsx").then(a.bind(null,"8d67"))},mixins:[p],data(){return{tableParams:{current:1,pageSize:10},total:0,selectedData:[],tableData:[],loading:!0}},computed:{slotColumns(){return y(this)},customRenderKeys(){const t=this.slotColumns.map(t=>t.scopedSlots.customRender).filter(t=>this.$scopedSlots[t]);return P(t),t},nativeRenderKeys(){return f.filter(t=>this.$scopedSlots[t])},rowSelection(){return this.selection||this.selectedKeys?Object(r["a"])({fixed:!0,selectedRowKeys:this.selectedKeys,onChange:this.onSelectChange,onSelect:this.needSelectAction&&this.selectOneHandler,onSelectAll:this.needSelectAction&&this.selectAllHandler},this.selection||{}):null},isCompleteData(){return!this.pagination||this.isPaging||Array.isArray(this.dataSource)}},beforeCreate(){this.changeRows=[],this.selected=!1,this.cacheTableParams={}},created(){this.needSelectAction=!!(Array.isArray(this.selectedKeys)&&this.$listeners.select||this.isXlsx),this.lazy||this.setTableList(),this.needSelectAction||this.$watch("selectedKeys",t=>{this.selectedData=this.selectedData.filter(e=>t.includes(d(this.rowKey,e))),this.$emit("select",this.selectedData,this.changeRows,this.selected)})},methods:{setTableParams({current:t,pageSize:e},a,s){this.tableParams.current===t&&this.tableParams.current===e||this.$emit("change-params",{current:t,pageSize:e}),o(this.tableParams.filter,a)||(this.updateForce(),this.$emit("change-filter",a)),o(this.tableParams.sorter,s)||(this.updateForce(),this.$emit("change-sorter",s)),this.tableParams={current:t,pageSize:e,filter:a,sorter:s},this.setTableList()},updateForce(){this.total=0},async setTableList(){if(this.loading=!0,this.isCompleteData){if(!this.total||this.isReload){const{filter:t,sorter:e}=this.tableParams,a=await this.getData(Object(r["a"])({filter:t,sorter:e},this.params));[this.total,this.tableData]=[a.total,a.data]}this.$emit("change",u(this.tableData,this.tableParams))}else{const t=await this.getData(Object(r["a"])(Object(r["a"])({},this.tableParams),this.params));[this.total,this.tableData]=[t.total,t.data],this.$emit("change",this.tableData)}if(this.tableParams.current>1&&!this.tableData.length)return this.tableParams.current-=1,void this.setTableList();this.isReload&&this.$emit("update:is-reload",!1),this.loading=!1},async getData(t){if(Array.isArray(this.dataSource)){const t=this.handler(this.dataSource);return{data:t,total:t.length}}let e={};try{e=await this.http(t),e.data=this.handler(e.data)}catch(a){e={data:[],total:0}}return e},onSelectChange(t){this.$emit("update:selected-keys",t)},selectAllHandler(t,e,a){a.forEach(e=>this.changeSelection(e,t)),[this.changeRows,this.selected]=[a,t]},selectOneHandler(t,e){this.changeSelection(t,e),[this.changeRows,this.selected]=[[t],e]},changeSelection(t,e){const a=d(this.rowKey,t),s=this.selectedData.findIndex(t=>d(this.rowKey,t)===a);e?s<0&&this.selectedData.push(t):s>-1&&(this.selectedData.splice(s,1),this.changeSelection(t,!1))},exportCurrent(){this.exportXlsx(this.isCompleteData?u(this.tableData,this.tableParams):this.tableData)},exportSelected(){this.exportXlsx(this.selectedData)},async exportAllXlsx(t=1){try{let e=[];const a={current:t,pageSize:500};if(!this.pagination||this.isPaging||Array.isArray(this.dataSource)?e=u(this.tableData,a):this.http&&(e=(await this.getData(Object(r["a"])(Object(r["a"])({},a),this.params))).data),this.exportXlsx(e,this.fileName+t),e.length<500)return;await this.exportAllXlsx(t+1)}catch(e){this.$emit("export-error",e)}},exportXlsx(t,e=this.fileName){this.xlsx({dataSource:t,fileName:e,columns:this.columns.filter(t=>x(t,"xlsx"))})}}};const y=function({columns:t,series:e,tableParams:{current:a,pageSize:s}}){var i;const l=t.filter(t=>x(t,"table")).map(S),n=b;if(e&&l.length&&l[0].key!==(null!==(i=e.key)&&void 0!==i?i:n)){const t=Object(r["a"])({key:n,title:"序号",width:68,customRender:w(a,s)},e);l.unshift(S(t))}return l},x=function({visible:t=!0},e){return!0===t||t===e},S=function(t){const{key:e,dataIndex:a,scopedSlots:s}=t,i=Object(l["a"])(t,["key","dataIndex","scopedSlots"]);return Object(r["a"])({key:null!==e&&void 0!==e?e:a,dataIndex:null!==a&&void 0!==a?a:e,scopedSlots:null!==s&&void 0!==s?s:{customRender:null!==a&&void 0!==a?a:e}},i)},w=function(t,e){return(a,s,i)=>(t-1)*e+i+1},P=function(){return()=>!0}();var D=g,A=(a("f89d"),a("2877")),T=Object(A["a"])(D,s,i,!1,null,"8e975f98",null);e["default"]=T.exports},f89d:function(t,e,a){"use strict";var s=a("2d11"),i=a.n(s);i.a}}]);