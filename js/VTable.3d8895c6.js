(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["VTable"],{8874:function(e,t,a){},e996:function(e,t,a){"use strict";var s=a("8874"),i=a.n(s);i.a},f4f7:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"own-table"},[a("ATable",e._g(e._b({attrs:{columns:e.slotColumns,"data-source":e.tableData,loading:e.loading,pagination:e.pagination&&Object.assign({},e.pagination,{total:e.total},e.tableParams),"row-key":e.rowKey,"row-selection":e.selection,scroll:e.scroll},on:{change:e.setTableParams},scopedSlots:e._u([e._l(e.nativeRenderKeys,(function(t){return{key:t,fn:function(a){return[e._t(t,null,null,a)]}}})),e._l(e.customRenderKeys,(function(t){return{key:t,fn:function(s,i,l){return[e._t(t,[a("span",{key:t+"-"+l},[e._v(e._s(s))])],null,{row:i,index:l,value:s})]}}}))],null,!0)},"ATable",e.$attrs,!1),e.$listeners)),e.isXlsx&&"function"===typeof e.xlsx&&!e.loading?[a("TableToXlsx",{attrs:{"is-selection":!!e.selection,loading:e.loading},on:{export:e.exportCurrent,"export-all":function(t){return e.exportAllXlsx()},"export-selected":e.exportSelected}})]:e._e()],2)},i=[],l=(a("2532"),a("ddb0"),a("15fd")),r=a("5530"),n=(a("5319"),a("fd4e"));const o=n["c"],c=/\[(?:(\d+)|['"]([^.[]+)['"])]|\.(\w+)|^(\w+)/g,h=Object(n["a"])(e=>{const t=[];return e.replace(c,(...e)=>{const a=e.slice(1,-2).find(Boolean);t.push(a)}),t});function d(e,t){if(Object(n["j"])(e)){const a=h(e);return a.reduce((e,t)=>e[t],t)}return Object(n["i"])(e)?e(t):t}function u(e,{current:t=1,pageSize:a}){const s=(t-1)*a;return e.slice(s,s+a)}function p(...e){return function(...t){e.forEach(e=>Object(n["i"])(e)&&e(...t))}}var b={props:{rowKey:{type:[Function,String],required:!0},series:{type:[Boolean,Object],default:!0},lazy:Boolean,isPaging:Boolean,columns:{type:Array,required:!0,validator:e=>e.every(e=>void 0!==(e.key||e.dataIndex))},http:Function,dataSource:Array,isXlsx:Boolean,xlsx:Function,fileName:{type:String,default:"file"},params:Object,pagination:{type:[Object,Boolean],default:()=>({position:"bottom",showSizeChanger:!0,showQuickJumper:!0,showTotal:e=>`共 ${e} 条`})},current:{type:Number,default:1},pageSize:{type:Number,default:10},rowSelection:{type:Object,validator:e=>!Object(n["g"])(e,"selectedRowKeys")||(console.error("[table]: `rowSelection.selectedRowKeys` is invalid, and use `selectedKeys`"),!1)},selectedKeys:Array,scroll:Object,handler:{type:Function,default:e=>e},isReload:Boolean},watch:{params:{handler(e){if(o(e,this.cacheTableParams))return;this.cacheTableParams=Object(r["a"])({},e),this.updateForce();const{pageSize:t,filter:a,sorter:s}=this.tableParams;this.setTableParams({current:1,pageSize:t},a,s)},deep:!0},current:{handler(e){this.tableParams.current=Math.max(e,1)},immediate:!0},pageSize:{handler(e){this.tableParams.pageSize=Math.max(e,1)},immediate:!0},isReload(e){e&&this.setTableList()},dataSource(){this.updateForce(),this.setTableList()}}};const m="__SLOT_SERIAL_NUMBER__",f=["title","expandedRowRender","expandIcon","footer"],g=f.concat(m);var y={name:"VTable",components:{TableToXlsx:()=>a.e("TableToXlsx").then(a.bind(null,"8d67"))},mixins:[b],data(){return{tableParams:{current:1,pageSize:10},total:0,selectedData:[],tableData:[],loading:!0}},computed:{slotColumns(){return S(this)},customRenderKeys(){const e=this.slotColumns.map(e=>e.scopedSlots.customRender).filter(e=>this.$scopedSlots[e]);return v(e),e},nativeRenderKeys(){return g.filter(e=>this.$scopedSlots[e])},selection(){const e=this.rowSelection;if(e||this.selectedKeys)return Object(r["a"])(Object(r["a"])({fixed:!0},e),{},{selectedRowKeys:this.selectedKeys,onChange:p(this.onSelectChange,null===e||void 0===e?void 0:e.onChange),onSelect:p(this.needSelectAction&&this.selectOneHandler,null===e||void 0===e?void 0:e.onSelect),onSelectAll:p(this.needSelectAction&&this.selectAllHandler,null===e||void 0===e?void 0:e.onSelectAll)})},isCompleteData(){return!this.pagination||this.isPaging||Array.isArray(this.dataSource)}},beforeCreate(){this.changeRows=[],this.selected=!1,this.cacheTableParams={}},created(){this.needSelectAction=!!(Array.isArray(this.selectedKeys)&&this.$listeners.select||this.isXlsx),this.needSelectAction&&this.$watch("selectedKeys",e=>{const t=[...this.selectedData,...this.tableData];this.selectedData=t.filter(t=>e.includes(this.getKeyByRow(t))),this.$emit("select",this.selectedData,this.changeRows,this.selected)})},mounted(){this.lazy||this.setTableList()},methods:{setTableParams({current:e,pageSize:t},a,s){this.tableParams.current===e&&this.tableParams.current===t||this.$emit("change-params",{current:e,pageSize:t}),o(this.tableParams.filter,a)||(this.updateForce(),this.$emit("change-filter",a)),o(this.tableParams.sorter,s)||(this.updateForce(),this.$emit("change-sorter",s)),this.tableParams={current:e,pageSize:t,filter:a,sorter:s},this.setTableList()},updateForce(){this.total=0},async setTableList(){if(this.loading=!0,this.isCompleteData){if(!this.total||this.isReload){const{filter:e,sorter:t}=this.tableParams,a=await this.getData(Object(r["a"])({filter:e,sorter:t},this.params));[this.total,this.tableData]=[a.total,a.data]}this.$emit("change",u(this.tableData,this.tableParams))}else{const e=await this.getData(Object(r["a"])(Object(r["a"])({},this.tableParams),this.params));[this.total,this.tableData]=[e.total,e.data],this.$emit("change",this.tableData)}if(this.tableParams.current>1&&!this.tableData.length)return await this.backLastPage();this.isReload&&this.$emit("update:is-reload",!1),this.loading=!1},backLastPage(){return this.tableParams.current-=1,this.setTableList()},async getData(e){if(Array.isArray(this.dataSource)){const e=this.handler(this.dataSource);return{data:e,total:e.length}}let t={};try{t=await this.http(this.filterParams(e)),t.data=this.handler(t.data)}catch(a){t={data:[],total:0}}return t},filterParams(e){let{filter:t,sorter:a}=e,s=Object(l["a"])(e,["filter","sorter"]);return Object(n["h"])(t)||(s.filter=t),Object(n["h"])(a)||(s.sorter=a),s},onSelectChange(e){this.$emit("update:selected-keys",e)},selectAllHandler(e,t,a){a.forEach(t=>this.changeSelection(t,e)),[this.changeRows,this.selected]=[a,e]},selectOneHandler(e,t){this.changeSelection(e,t),[this.changeRows,this.selected]=[[e],t]},changeSelection(e,t){const a=this.getKeyByRow(e),s=this.selectedData.findIndex(e=>this.getKeyByRow(e)===a);t?s<0&&this.selectedData.push(e):s>-1&&(this.selectedData.splice(s,1),this.changeSelection(e,!1))},exportCurrent(){this.exportXlsx(this.isCompleteData?u(this.tableData,this.tableParams):this.tableData)},exportSelected(){this.exportXlsx(this.selectedData)},async exportAllXlsx(e=1){try{let t=[];const a={current:e,pageSize:500};if(!this.pagination||this.isPaging||Array.isArray(this.dataSource)?t=u(this.tableData,a):this.http&&(t=(await this.getData(Object(r["a"])(Object(r["a"])({},a),this.params))).data),this.exportXlsx(t,this.fileName+e),t.length<500)return;await this.exportAllXlsx(e+1)}catch(t){this.$emit("export-error",t)}},exportXlsx(e,t=this.fileName){this.xlsx({dataSource:e,fileName:t,columns:this.columns.filter(e=>x(e,"xlsx"))})},getKeyByRow(e){return d(this.rowKey,e)}}};const S=function({columns:e,series:t,tableParams:{current:a,pageSize:s}}){var i;const l=e.filter(e=>x(e,"table")).map(w),n=m;if(t&&l.length&&l[0].key!==(null!==(i=t.key)&&void 0!==i?i:n)){const e=Object(r["a"])({key:n,title:"序号",width:68,customRender:P(a,s)},t);l.unshift(w(e))}return l},x=function({visible:e=!0},t){return!0===e||e===t},w=function(e){const{key:t,dataIndex:a,scopedSlots:s}=e,i=Object(l["a"])(e,["key","dataIndex","scopedSlots"]);return Object(r["a"])({key:null!==t&&void 0!==t?t:a,dataIndex:null!==a&&void 0!==a?a:t,scopedSlots:null!==s&&void 0!==s?s:{customRender:null!==a&&void 0!==a?a:t}},i)},P=function(e,t){return(a,s,i)=>(e-1)*t+i+1},v=function(){return()=>!0}();var O=y,j=(a("e996"),a("2877")),D=Object(j["a"])(O,s,i,!1,null,"251201e6",null);t["default"]=D.exports}}]);